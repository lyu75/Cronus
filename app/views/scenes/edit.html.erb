<div class="container">

<%= link_to "see all scenes", project_elaborate_scenes_path(@scene.project) %>

<h2><%= @scene.summary %></h2>
<p class="floatRight">*Note: Scene name will not be displayed to readers</p><br>

<div>
  <h3>Content preview: </h3>

    <div class="no-text-overflow">
      <p id="contentPreview" class="proj-display show-line-break"></p>
    </div>
</div>


<div>
  <p>Decisions: </p>
  <% @scene.decisions.each do |d| %>
    <p><%= d.description %></p>
  <% end %>
</div>

<script type="text/javascript" id="code">
  var projectId = <%= @scene.project.id %>;
  var sceneId = <%= @scene.id %>;
  function init(){
    $.ajax({
      type: "GET",
      url:"/projects/"+projectId+"/scenes/"+sceneId+"/json",
      success: function(data, textStatus, jqXHR){
        console.log(data);
        document.getElementById("sceneContent").value = data.scene.content;
        document.getElementById("contentPreview").innerHTML = data.scene.content;
      },
      error: function(jqXHR, textStatus, errorThrown){
        console.log("faaaaaaa");
      }
    });
  };

  function editScene(projectId, sceneId, scene){
    $.ajax({
      type: "PATCH",
      url:"/projects/"+projectId+"/scenes/"+sceneId,
      data: scene,
      success: function(data, textStatus, jqXHR){
        console.log("eihei");
      },
      error: function(jqXHR, textStatus, errorThrown){
        console.log("faaaaaaa");
      }
    });
  };

  function save(){
    let newContent = document.getElementById("sceneContent").value;
    let newScene = {
      scene: {
        content: newContent
      }
    };
    editScene(projectId, sceneId, newScene);
  };

  function load(){
    $.ajax({
      type: "GET",
      url:"/projects/"+projectId+"/scenes/"+sceneId+"/json",
      success: function(data, textStatus, jqXHR){
        console.log(data);
        document.getElementById("sceneContent").value = data.scene.content;
        document.getElementById("contentPreview").innerHTML = data.scene.content;
      },
      error: function(jqXHR, textStatus, errorThrown){
        console.log("faaaaaaa");
      }
    });
  };


</script>

<div>
  <textarea id="sceneContent" style="width:100%;height:300px">
  </textarea>
  <div class="floatRight">
    <button onclick="save()">Save scene content</button>
    <button onclick="load()">Load scene content</button>
</div>
</div>
